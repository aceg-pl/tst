<!doctype html>
<meta charset="utf-8">
<title>Sport TV Today</title>

<style>
body{font:14px system-ui;margin:20px}
.item{margin-bottom:12px}
.time{color:#666;font-size:12px}
.err{color:#b00}
</style>

<div id="feed">Loading…</div>

fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent("https://www.open-epg.com/files/poland1.xml"))
.then(r => r.text())
.then(t => {
    let d = new DOMParser().parseFromString(t, "text/xml"),
        o = "",
        now = new Date(),
        // Format YYYYMMDD to match XMLTV start time format
        todayStr = now.getFullYear() + 
                   String(now.getMonth() + 1).padStart(2, '0') + 
                   String(now.getDate()).padStart(2, '0');

    let programs = [...d.getElementsByTagName("programme")];

    programs.forEach(p => {
        let channelId = p.getAttribute("channel") || "";
        let start = p.getAttribute("start") || "";
        let title = p.getElementsByTagName("title")[0]?.textContent || "";
        let desc = p.getElementsByTagName("desc")[0]?.textContent || "";
        let category = p.getElementsByTagName("category")[0]?.textContent || "";

        // CHECK: 1. Is it today? 2. Is 'sport' mentioned in ID, Title, or Category?
        let isSport = /sport/i.test(channelId) || /sport/i.test(category) || /sport/i.test(title);
        
        if (isSport && start.startsWith(todayStr)) {
            let time = start.slice(8, 10) + ":" + start.slice(10, 12);
            o += `<div class="item">
                    <b>${title}</b>
                    <div class="time">${channelId.replace('.pl', '')} · ${time}</div>
                    <small>${desc.substring(0, 100)}${desc.length > 100 ? '...' : ''}</small>
                  </div>`;
        }
    });

    document.getElementById("feed").innerHTML = o || "No sport found for today.";
})
.catch(err => {
    document.getElementById("feed").innerHTML = "Error loading feed.";
    console.error(err);
});
